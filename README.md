

# Beagle
## Running in Dev

### Install the required libraries
- Install [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/index.html), [Vagrant](https://www.vagrantup.com/), [VirtualBox](https://www.virtualbox.org/)
- To make sure both Vagrant and Ansible are installed, run:
- `$ vagrant --version`
- `$ ansible --version`
- You should be able to see the version of both vagrant and ansible if they are installed properly.

### Start the Vagrant VM environment
- To launch the VM, go into the beagle folder of the workspace before launching vagrant:
- `$ vagrant up`
- We then have separate provisioners for Kibble, Spot and Dogbone using ansible playbooks.
- Any subsequence vagrant related commands need to be ran in the beagle folder.

# Kibble
## Configure Kibble
### First time setup
- Fill in the required variables in the file `secret.yml` in the `Kibble/ansible/vars/` directory.
- The only mandatory variables to run locally are the `superuser_username` and `superuser_username`.
- In the `local_settings.py` under `Kibble/kibble/app_settings`, make sure `DEBUG` is set to `True`. The `HOT_LOAD` variable is required if hot reload is wanted for the React-webpack front end.

### Provisioning
- Provisioning with vagrant will run the related ansible scripts to install the required libraries on the VM and will automatically configure any environment settings.
- `$ vagrant provision --provision-with kibble`

## Launching Kibble
### Django server
- `$ vagrant ssh`
- `$ cd /srv/kibble`
- `$ source ../venv/bin/activate`
- `$ python manage.py createsuperuser`
- `$ python manage.py runserver 0.0.0.0:8001`
- Login to admin as socket requires a session_key, which is generated by a logged in user.

_Convenience one-liner:_ `cd /srv/kibble && source ../venv/bin/activate && python manage.py runserver 0.0.0.0:8001`

### Socket server
In new terminal run:
- `$ vagrant ssh`
- `$ cd /srv/kibble/realtime/node`
- `$ npm install`
- `$ node server.js`

_Convenience one-liner:_ `cd /srv/kibble/realtime/node && node server.js`

### Celery beat
(OPTIONAL)
In new terminal run:
- `$ vagrant ssh`
- `$ cd /srv/kibble`
- `$ source ../venv/bin/activate`
- `$ celery -A kibble beat -l info`

_Convenience one-liner:_ `cd /srv/kibble && source ../venv/bin/activate && celery -A kibble beat -l info`

Note: required for enabling the online cloud folder watcher (otherwise optional)

### Celery worker
In new terminal run:
- `$ vagrant ssh`
- `$ cd /srv/kibble`
- `$ source ../venv/bin/activate`
- `$ celery -A kibble worker -l info --discard`

_Convenience one-liner:_ `cd /srv/kibble && source ../venv/bin/activate && celery -A kibble worker -l info --discard`

### Compile front end.
(Only need to run if using hot reload or making changes to the front end)
Outside vagrant environment
- `$ cd portal/static/js`
- `$ npm install`
- `$ npm run dist` for js file.
    - Or for hot reload:
    - `$ npm start`

If you use npm run dist, make sure to run collectstatic to group up the static files.

# Delorean
## Launching Delorean
- Run this in the vagrant VM
- `$ vagrant ssh`
- `$ cd /srv/delorean`
- `$ source ../venv/bin/activate`
- `$ python app.py`
